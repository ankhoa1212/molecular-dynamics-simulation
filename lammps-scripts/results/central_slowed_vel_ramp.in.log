LAMMPS (29 Aug 2024 - Update 1)
  using 4 OpenMP thread(s) per MPI task
# LAMMPS Input Script: Gradually lower velocity for atoms closer to the center

# --- Initialization ---
units lj          # Use Lennard-Jones units
atom_style ellipsoid
dimension 3       # 3D simulation
boundary f f p    # Set boundary conditions: fixed (non-periodic) in x and y, periodic in z (standard for 2D)

# --- System Definition ---
variable box_size equal 200
variable half_box equal ${box_size}/2
variable half_box equal 200/2
region box block 0 ${box_size} 0 ${box_size} -0.5 0.5 units box # Define simulation box boundaries
region box block 0 200 0 ${box_size} -0.5 0.5 units box 
region box block 0 200 0 200 -0.5 0.5 units box 
create_box 1 box                     # Create the simulation box with 1 atom type
Created orthogonal box = (0 0 -0.5) to (200 200 0.5)
  1 by 1 by 1 MPI processor grid

create_atoms 1 random 100 12345 NULL overlap 3.9 maxtry 50
Created 100 atoms
  using lattice units in orthogonal box = (0 0 -0.5) to (200 200 0.5)
  create_atoms CPU = 0.003 seconds

# --- Define the circular slowing region and related variables ---
variable center_x equal ${half_box}
variable center_x equal 100
variable center_y equal ${half_box}
variable center_y equal 100
variable inner_radius equal 1.0   # Radius where maximum damping starts
variable outer_radius equal 50.0   # Radius where damping ends (beyond this, no damping)

# Group for atoms within the outer_radius of the damping region
region damping_region sphere ${center_x} ${center_y} 0.0 ${outer_radius} units box
region damping_region sphere 100 ${center_y} 0.0 ${outer_radius} units box
region damping_region sphere 100 100 0.0 ${outer_radius} units box
region damping_region sphere 100 100 0.0 50 units box
group damp_group region damping_region
21 atoms in group damp_group

# Set ellipsoid shape
# This sets the semi-axes lengths for a sphere
set type 1 shape 0.5 0.5 0.5
Setting atom values ...
  100 settings made for shape

set atom 1 mass 1.0                           # Set mass of atom type 1
Setting atom values ...
  1 settings made for mass

# --- Variables for initial velocities ---
variable vel_scale equal 10              # Scaling factor for initial velocity magnitude (adjust if needed)

# --- Interactions ---
pair_style lj/cut 2.5
pair_coeff 1 1 1.0 1.0 2.5

# --- Initial Velocities --
variable vx_init atom v_vel_scale*(${half_box}-x)
variable vx_init atom v_vel_scale*(100-x)
variable vy_init atom v_vel_scale*(${half_box}-y)
variable vy_init atom v_vel_scale*(100-y)
# Apply the calculated velocities to all atoms, initializing at zero total linear momentum
velocity all set v_vx_init v_vy_init 0.0 sum yes
# velocity damp_group set 0.0 0.0 0.0 sum no
# velocity damp_group ramp vx 1 0 x ${center_x}-${outer_radius} ${center_x}+${outer_radius} sum no
# velocity damp_group ramp vy 1 0 y ${center_y}-${outer_radius} ${center_y}+${outer_radius} sum no

variable min_x equal ${center_x}-${outer_radius}
variable min_x equal 100-${outer_radius}
variable min_x equal 100-50
variable max_x equal ${center_x}+${outer_radius}
variable max_x equal 100+${outer_radius}
variable max_x equal 100+50
variable min_y equal ${center_y}-${outer_radius}
variable min_y equal 100-${outer_radius}
variable min_y equal 100-50
variable max_y equal ${center_y}-${outer_radius}
variable max_y equal 100-${outer_radius}
variable max_y equal 100-50

velocity damp_group ramp vx -1 1 x ${min_x} ${max_x} sum yes
velocity damp_group ramp vx -1 1 x 50 ${max_x} sum yes
velocity damp_group ramp vx -1 1 x 50 150 sum yes
velocity damp_group ramp vy -1 1 y ${min_y} ${max_y} sum yes
velocity damp_group ramp vy -1 1 y 50 ${max_y} sum yes
velocity damp_group ramp vy -1 1 y 50 50 sum yes


#ramp args = vdim vlo vhi dim clo chi
#  vdim = vx or vy or vz
#  vlo,vhi = lower and upper velocity value (velocity units)
#  dim = x or y or z
#  clo,chi = lower and upper coordinate bound (distance units)


# --- Velocity Damping based on distance ---
# Calculate the distance of each atom from the center of the slowing region
variable dist atom sqrt((x-${center_x})^2+(y-${center_y})^2)
variable dist atom sqrt((x-100)^2+(y-${center_y})^2)
variable dist atom sqrt((x-100)^2+(y-100)^2)

# Calculate a damping coefficient (gamma) that increases as distance decreases
# - Be 0 when dist >= outer_radius
# - Be 1 when dist <= inner_radius
# - Linearly interpolate between 0 and 1 for inner_radius < dist < outer_radius
variable damping_coeff atom ramp(v_dist,${inner_radius},${outer_radius},1.0,0.0)
variable damping_coeff atom ramp(v_dist,1,${outer_radius},1.0,0.0)
variable damping_coeff atom ramp(v_dist,1,50,1.0,0.0)

# We want damping_coeff to be 0 at outer_radius, and max_damping at inner_radius
# max_damping * (outer_radius - dist) / (outer_radius - inner_radius)
variable max_damping equal 1.0 # Adjust this value to control the maximum damping strength

# variable gamma_val atom "v_max_damping * (max(0.0, ${outer_radius}-v_dist) / (${outer_radius}-${inner_radius}))"
variable gamma_val equal 1000*step

# Apply viscous damping using fix viscous
# The 'gamma' (damping coefficient) is applied to each component of velocity.
# A higher gamma value means stronger damping.
# We apply it to 'damp_group' which includes all atoms within outer_radius


# --- Integration ---
fix 1 all nve
fix 2 all langevin 5.0 0.1 1.0 48279
fix 3 damp_group viscous ${gamma_val}
fix 3 damp_group viscous 0

# --- Simulation Settings ---
timestep 0.00001 # Timestep for integration (in lj time units) - Keep it small for stability
thermo 100     # Output thermodynamic info every 100 steps
thermo_style custom step temp pe ke etotal press vol atoms # Added 'atoms' to check count

# --- Output ---
# Dump atom positions and velocities every 100 steps to log.lammpstrj file
dump 1 all custom 100 central_slowed_vel_ramp.in.lammpstrj id type x y vx vy fx fy v_dist

# --- Run Simulation ---
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 2.8
  ghost atom cutoff = 2.8
  binsize = 1.4, bins = 143 143 1
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut, perpetual
      attributes: half, newton on
      pair build: half/bin/atomonly/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 9.665 | 9.665 | 9.665 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Atoms   
         0   219760.96     -0.061523437    326345.02      326344.96      543.92807      40000                100 
       100   219324.84     -0.061523437    325697.39      325697.33      542.84868      40000                100 
       200   218888.92     -0.061523437    325050.05      325049.99      541.76978      40000                100 
       300   218442.43     -0.061523437    324387.01      324386.95      540.66472      40000                100 
       400   218006.71     -0.061523437    323739.97      323739.9       539.58631      40000                100 
       500   217573.96     -0.061523437    323097.32      323097.26      538.51524      40000                100 
       600   217140.24     -0.061523437    322453.26      322453.19      537.44179      40000                100 
       700   216713.43     -0.061523437    321819.44      321819.38      536.38544      40000                100 
       800   216283.29     -0.061523437    321180.68      321180.62      535.32083      40000                100 
       900   215857.62     -0.061523437    320548.57      320548.51      534.26731      40000                100 
      1000   215434.68     -0.061523437    319920.49      319920.43      533.22052      40000                100 
      1100   214993.66     -0.061523437    319265.59      319265.53      532.12902      40000                100 
      1200   214571.08     -0.061523437    318638.05      318637.99      531.08311      40000                100 
      1300   214144.69     -0.061523437    318004.86      318004.8       530.0278       40000                100 
      1400   213721.76     -0.061523437    317376.82      317376.76      528.98106      40000                100 
      1500   213292.8      -0.061523437    316739.81      316739.75      527.91938      40000                100 
      1600   212862.06     -0.061523437    316100.16      316100.1       526.8533       40000                100 
      1700   212442.13     -0.061523437    315476.56      315476.5       525.81397      40000                100 
      1800   212011.72     -0.061523437    314837.4       314837.34      524.74869      40000                100 
      1900   211584        -0.061523437    314202.24      314202.18      523.6901       40000                100 
      2000   211168.04     -0.061523437    313584.54      313584.48      522.66059      40000                100 
      2100   210754.42     -0.061523437    312970.31      312970.25      521.63688      40000                100 
      2200   210328.08     -0.061523437    312337.2       312337.13      520.58169      40000                100 
      2300   209908.22     -0.061523437    311713.7       311713.64      519.54253      40000                100 
      2400   209483.52     -0.061523437    311083.02      311082.96      518.4914       40000                100 
      2500   209064.26     -0.061523437    310460.42      310460.36      517.45373      40000                100 
      2600   208644.43     -0.061523437    309836.98      309836.92      516.41467      40000                100 
      2700   208230.4      -0.061523437    309222.14      309222.08      515.38993      40000                100 
      2800   207822.77     -0.061523437    308616.81      308616.75      514.38105      40000                100 
      2900   207409.99     -0.061523437    308003.83      308003.77      513.35942      40000                100 
      3000   206994.6      -0.061523437    307386.97      307386.91      512.33132      40000                100 
      3100   206575.2      -0.061523437    306764.18      306764.12      511.29332      40000                100 
      3200   206167.73     -0.061523437    306159.08      306159.02      510.28484      40000                100 
      3300   205762.41     -0.061523437    305557.19      305557.12      509.28167      40000                100 
      3400   205358.34     -0.061523437    304957.13      304957.07      508.28158      40000                100 
      3500   204938.94     -0.061523437    304334.33      304334.27      507.24359      40000                100 
      3600   204523.15     -0.061523437    303716.88      303716.81      506.21449      40000                100 
      3700   204109.74     -0.061523437    303102.97      303102.91      505.19131      40000                100 
      3800   203702.53     -0.061523437    302498.25      302498.19      504.18345      40000                100 
      3900   203294.72     -0.061700932    301892.67      301892.6       503.17414      40000                100 
      4000   202886.37     -0.061718338    301286.26      301286.19      502.16346      40000                100 
      4100   202483.43     -0.061917656    300687.89      300687.83      501.16617      40000                100 
      4200   202071.99     -0.062126309    300076.91      300076.85      500.14788      40000                100 
      4300   201670.45     -0.062187749    299480.63      299480.56      499.15407      40000                100 
      4400   201269.98     -0.062429898    298885.91      298885.85      498.16288      40000                100 
      4500   200868.46     -0.062697366    298289.66      298289.6       497.16912      40000                100 
      4600   200469.35     -0.062991536    297696.98      297696.92      496.18133      40000                100 
      4700   200068.72     -0.063311706    297102.05      297101.98      495.18977      40000                100 
      4800   199665.11     -0.063500404    296502.69      296502.62      494.19083      40000                100 
      4900   199261.67     -0.064058415    295903.57      295903.51      493.19231      40000                100 
      5000   198861.32     -0.064334143    295309.06      295308.99      492.20145      40000                100 
      5100   198475.78     -0.064990095    294736.54      294736.47      491.24724      40000                100 
      5200   198078.83     -0.065375407    294147.07      294147         490.26479      40000                100 
      5300   197674.65     -0.065811728    293546.86      293546.8       489.26445      40000                100 
      5400   197274.04     -0.066482093    292951.95      292951.88      488.27292      40000                100 
      5500   196881.96     -0.067064302    292369.72      292369.65      487.30253      40000                100 
      5600   196490.5      -0.068057036    291788.39      291788.32      486.33364      40000                100 
      5700   196095.69     -0.06902815     291202.09      291202.02      485.35648      40000                100 
      5800   195699.27     -0.070133711    290613.41      290613.34      484.37534      40000                100 
      5900   195307.34     -0.071727311    290031.41      290031.34      483.40533      40000                100 
      6000   194911.65     -0.073005252    289443.8       289443.73      482.42598      40000                100 
      6100   194526.57     -0.074473583    288871.96      288871.89      481.4729       40000                100 
      6200   194137.44     -0.076858799    288294.1       288294.02      480.50978      40000                100 
      6300   193752.39     -0.079053468    287722.3       287722.22      479.55678      40000                100 
      6400   193361.05     -0.081750644    287141.16      287141.08      478.5882       40000                100 
      6500   192970.27     -0.08468176     286560.85      286560.77      477.62101      40000                100 
      6600   192582.38     -0.088582796    285984.83      285984.74      476.66095      40000                100 
      6700   192195.98     -0.092523153    285411.03      285410.94      475.70461      40000                100 
      6800   191809.94     -0.097065316    284837.76      284837.66      474.74913      40000                100 
      6900   191437.23     -0.10261503     284284.29      284284.19      473.82667      40000                100 
      7000   191055.7      -0.1089098      283717.71      283717.6       472.88234      40000                100 
      7100   190676.81     -0.11616097     283155.07      283154.95      471.94458      40000                100 
      7200   190303.53     -0.12473271     282600.74      282600.62      471.02068      40000                100 
      7300   189919.51     -0.13423668     282030.48      282030.34      470.07022      40000                100 
      7400   189541.75     -0.14366791     281469.49      281469.35      469.13524      40000                100 
      7500   189164.78     -0.15325009     280909.7       280909.55      468.20226      40000                100 
      7600   188790.39     -0.16093535     280353.73      280353.57      467.2757       40000                100 
      7700   188408.97     -0.16369919     279787.32      279787.15      466.33183      40000                100 
      7800   188032.8      -0.15445615     279228.7       279228.55      465.40112      40000                100 
      7900   187661.13     -0.12379325     278676.78      278676.66      464.48183      40000                100 
      8000   187286.29     -0.049776111    278120.14      278120.09      463.5552       40000                100 
      8100   186911.38      0.10614414     277563.4       277563.51      462.62934      40000                100 
      8200   186539.06      0.41472715     277010.5       277010.91      461.71153      40000                100 
      8300   186163.75      0.98206356     276453.16      276454.15      460.7891       40000                100 
      8400   185797.82      1.9432731      275909.77      275911.71      459.89404      40000                100 
      8500   185416.16      3.3487713      275342.99      275346.34      458.96468      40000                100 
      8600   185048.04      4.9772585      274796.34      274801.32      458.07125      40000                100 
      8700   184671.52      6.3984341      274237.21      274243.6       457.15508      40000                100 
      8800   184297.79      7.5644407      273682.22      273689.78      456.24337      40000                100 
      8900   183932.79      8.9236077      273140.19      273149.11      455.35546      40000                100 
      9000   183568.8       10.74983       272599.68      272610.42      454.47514      40000                100 
      9100   183197.81      13.124991      272048.75      272061.87      453.5835       40000                100 
      9200   182832.69      15.82373       271506.54      271522.37      452.7104       40000                100 
      9300   182453.95      18.369819      270944.11      270962.48      451.80324      40000                100 
      9400   182082.7       24.340068      270392.81      270417.15      450.95123      40000                100 
      9500   181707.77      39.977527      269836.04      269876.02      450.19089      40000                100 
      9600   181332.67      62.454202      269279.01      269341.47      449.50426      40000                100 
      9700   180927.39      125.11453      268677.18      268802.29      449.15673      40000                100 
      9800   180468.51      266.93888      267995.74      268262.68      449.48741      40000                100 
      9900   179911.78      565.19129      267168.99      267734.18      451.17236      40000                100 
     10000   179189.38      1106.7259      266096.23      267202.96      454.92018      40000                100 
     10100   178023.68      2297.6734      264365.17      266662.84      464.16008      40000                100 
     10200   175964.9       4824.9112      261307.88      266132.79      484.72634      40000                100 
     10300   162235.39      24691.497      240919.55      265611.05      650.9632       40000                100 
     10400   105914.54      107871.68      157283.09      265154.77      1346.9811      40000                100 
     10500   143622.87      51570.376      213279.96      264850.33      875.16007      40000                100 
     10600   171625.2       9523.0729      254863.42      264386.5       521.39532      40000                100 
     10700   175931.16      2613.0254      261257.77      263870.8       462.1552       40000                100 
     10800   176775.31      839.47647      262511.33      263350.81      446.21745      40000                100 
     10900   176605.06      551.92893      262258.51      262810.44      442.81559      40000                100 
     11000   176520.36      155.44641      262132.73      262288.17      438.55579      40000                100 
     11100   176196.52      114.35293      261651.83      261766.19      437.31117      40000                100 
     11200   175875.96      60.357412      261175.8       261236.16      435.95743      40000                100 
     11300   175561.16      15.858689      260708.32      260724.17      434.71797      40000                100 
     11400   175215.58      11.6149        260195.14      260206.75      433.81434      40000                100 
     11500   174854.4       27.385403      259658.78      259686.16      433.07787      40000                100 
     11600   174512.81      23.516727      259151.52      259175.04      432.19149      40000                100 
     11700   174171.02      19.098286      258643.96      258663.06      431.29774      40000                100 
     11800   173825.45      11.979546      258130.79      258142.77      430.36889      40000                100 
     11900   173482.2       5.5273487      257621.07      257626.6       429.45275      40000                100 
     12000   173139.2       2.5652475      257111.71      257114.27      428.57221      40000                100 
     12100   172800.55      1.1268434      256608.82      256609.95      427.71813      40000                100 
     12200   172452.95      0.57753553     256092.64      256093.21      426.85138      40000                100 
     12300   172110.16      0.30176533     255583.59      255583.89      425.99954      40000                100 
     12400   171767.12      0.078672803    255074.17      255074.25      425.14765      40000                100 
     12500   171433.29     -0.0629821      254578.44      254578.38      424.31949      40000                100 
     12600   171083.87     -0.12997358     254059.55      254059.42      423.45365      40000                100 
     12700   170739.01     -0.1610606      253547.43      253547.27      422.59954      40000                100 
     12800   170396.18     -0.17589844     253038.32      253038.15      421.75064      40000                100 
     12900   170056.62     -0.17717588     252534.07      252533.9       420.91002      40000                100 
     13000   169716.64     -0.16871219     252029.21      252029.04      420.06851      40000                100 
     13100   169377.02     -0.15929968     251524.87      251524.71      419.22793      40000                100 
     13200   169034.69     -0.15182041     251016.52      251016.37      418.38063      40000                100 
     13300   168699.03     -0.14682958     250518.06      250517.91      417.54981      40000                100 
     13400   168363.82     -0.14377603     250020.28      250020.14      416.7201       40000                100 
     13500   168026.54     -0.14237955     249519.42      249519.27      415.88525      40000                100 
     13600   167690.62     -0.13933574     249020.57      249020.43      415.05378      40000                100 
     13700   167355.4      -0.13548509     248522.77      248522.64      414.22408      40000                100 
     13800   167018.35     -0.13009189     248022.25      248022.12      413.38986      40000                100 
     13900   166678.38     -0.12433237     247517.4       247517.27      412.54844      40000                100 
     14000   166340.64     -0.11876785     247015.86      247015.74      411.71255      40000                100 
     14100   166017.17     -0.11288949     246535.5       246535.38      410.91197      40000                100 
     14200   165688.18     -0.10767809     246046.95      246046.84      410.09775      40000                100 
     14300   165349.44     -0.10262755     245543.92      245543.82      409.25939      40000                100 
     14400   165007.33     -0.098826525    245035.88      245035.78      408.41267      40000                100 
     14500   164681.87     -0.095474173    244552.57      244552.47      407.60716      40000                100 
     14600   164349.07     -0.092176173    244058.37      244058.28      406.78351      40000                100 
     14700   164024.12     -0.089255093    243575.82      243575.73      405.97927      40000                100 
     14800   163698.49     -0.08618562     243092.26      243092.18      405.17336      40000                100 
     14900   163372.47     -0.083917392    242608.11      242608.03      404.36645      40000                100 
     15000   163048.18     -0.081935637    242126.55      242126.47      403.56386      40000                100 
     15100   162722.54     -0.080002265    241642.97      241642.89      402.75789      40000                100 
     15200   162395.68     -0.078186364    241157.59      241157.51      401.94893      40000                100 
     15300   162071.93     -0.076288657    240676.82      240676.74      401.14766      40000                100 
     15400   161748        -0.074991092    240195.79      240195.71      400.34594      40000                100 
     15500   161425.11     -0.073578835    239716.29      239716.22      399.54679      40000                100 
     15600   161104.7      -0.072349319    239240.48      239240.4       398.75377      40000                100 
     15700   160784.49     -0.071438708    238764.97      238764.9       397.96127      40000                100 
     15800   160459.5      -0.070315148    238282.36      238282.29      397.15691      40000                100 
     15900   160140.92     -0.069109326    237809.27      237809.2       396.36844      40000                100 
     16000   159820.85     -0.068676927    237333.97      237333.9       395.57627      40000                100 
     16100   159500.24     -0.068149732    236857.86      236857.8       394.78277      40000                100 
     16200   159180.03     -0.067321401    236382.34      236382.27      393.99023      40000                100 
     16300   158858.49     -0.066825506    235904.86      235904.8       393.19444      40000                100 
     16400   158541.61     -0.066275786    235434.29      235434.22      392.41015      40000                100 
     16500   158218.33     -0.066001107    234954.23      234954.16      391.61005      40000                100 
     16600   157897.83     -0.065535677    234478.27      234478.21      390.8168       40000                100 
     16700   157575.77     -0.065104971    234000.02      233999.95      390.01971      40000                100 
     16800   157259.96     -0.064921967    233531.03      233530.97      389.23807      40000                100 
     16900   156941.63     -0.064370726    233058.33      233058.26      388.45023      40000                100 
     17000   156632.28     -0.064234945    232598.93      232598.87      387.68457      40000                100 
     17100   156318.2      -0.063894936    232132.52      232132.46      386.90722      40000                100 
     17200   156003.64     -0.063772033    231665.4       231665.34      386.12869      40000                100 
     17300   155699.32     -0.063637333    231213.49      231213.43      385.3755       40000                100 
     17400   155390.5      -0.063347365    230754.9       230754.83      384.61118      40000                100 
     17500   155086.88     -0.063398707    230304.02      230303.95      383.85971      40000                100 
     17600   154772.58     -0.062981599    229837.28      229837.21      383.08182      40000                100 
     17700   154458.17     -0.062894659    229370.38      229370.32      382.30366      40000                100 
     17800   154141.68     -0.062671011    228900.39      228900.33      381.52034      40000                100 
     17900   153840.85     -0.062591416    228453.66      228453.6       380.77579      40000                100 
     18000   153529.8      -0.062530193    227991.75      227991.68      380.00594      40000                100 
     18100   153223.4      -0.062480886    227536.75      227536.69      379.24761      40000                100 
     18200   152920.19     -0.062396626    227086.48      227086.41      378.49715      40000                100 
     18300   152621.51     -0.062225987    226642.94      226642.88      377.75793      40000                100 
     18400   152316.92     -0.062161769    226190.63      226190.57      377.00408      40000                100 
     18500   152023.06     -0.062157742    225754.24      225754.18      376.27676      40000                100 
     18600   151720.57     -0.062115197    225305.05      225304.99      375.52811      40000                100 
ERROR: Lost atoms: original 100 current 98 (src/thermo.cpp:494)
Last command: run 100000
